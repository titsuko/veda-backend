<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <title>Manage Users</title>
</head>
<body>

<div th:replace="~{layouts/topbar :: header}"></div>

<main class="container">
  <h1 class="container__title">Manage Users</h1>

  <div th:if="${param.error}" class="alert alert--error">
    <span th:text="${param.error}"></span>
  </div>

  <div class="table-wrapper">
    <table class="table">
      <thead>
      <tr>
        <th class="table__head-cell">Id</th>
        <th class="table__head-cell">Full Name</th>
        <th class="table__head-cell">Email</th>
        <th class="table__head-cell">Role</th>
        <th class="table__head-cell">Created At</th>
        <th class="table__head-cell">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user : ${usersPage.content}" class="table__row">
        <td class="table__cell" th:text="${user.id}"></td>
        <td class="table__cell" th:text="${user.fullName}"></td>
        <td class="table__cell" th:text="${user.email}"></td>
        <td class="table__cell">
        <span th:text="${user.role}"
              style="padding: 2px 8px; border-radius: 99px; background: #e0e7ff; color: #3730a3; font-size: 12px; font-weight: 600;">
        </span>
        </td>
        <td class="table__cell" th:text="${user.createdAt}"></td>

        <td class="table__cell">
          <div class="table__actions">
            <button type="button"
                    class="button button--edit"
                    data-action="edit"
                    th:data-id="${user.id}"
                    th:data-fullname="${user.fullName}"
                    th:data-email="${user.email}"
                    th:data-role="${user.role}">
              Edit
            </button>

            <form th:action="@{/admin/users/{id}/delete(id=${user.id})}" method="post" style="margin: 0;">
              <button type="button"
                      class="button button--danger"
                      data-action="delete">
                Delete
              </button>
            </form>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" th:if="${totalPages > 0}">
    <a th:if="${currentPage > 0}"
       class="button button--primary"
       th:href="@{/admin/users(page=${currentPage - 1})}">Previous</a>

    <span th:text="'Page ' + (${currentPage + 1}) + ' of ' + ${totalPages}"></span>

    <a th:if="${currentPage < totalPages - 1}"
       class="button button--primary"
       th:href="@{/admin/users(page=${currentPage + 1})}">Next</a>
  </div>

  <div id="editUserModal" class="modal">
    <div class="modal__content">
      <div class="modal__header">
        <h2 class="modal__title">Edit User</h2>
        <button type="button" class="modal__close" data-modal-close>&times;</button>
      </div>

      <form id="editUserForm" class="form" method="post">
        <div class="form__group">
          <label class="form__label">First Name</label>
          <input type="text" class="form__input" name="firstName" required>
        </div>

        <div class="form__group">
          <label class="form__label">Last Name</label>
          <input type="text" class="form__input" name="lastName" required>
        </div>

        <div class="form__group">
          <label class="form__label">Email</label>
          <input type="email" class="form__input" name="email" required>
        </div>

        <div class="form__group">
          <label class="form__label">Role</label>
          <select class="form__select" name="role">
            <option value="USER">USER</option>
            <option value="ADMIN">ADMIN</option>
          </select>
        </div>

        <button type="submit" class="button button--success">Save Changes</button>
      </form>
    </div>
  </div>

  <div id="deleteConfirmModal" class="modal">
    <div class="modal__content">
      <div class="modal__header">
        <h2 class="modal__title">Confirm Action</h2>
        <button type="button" class="modal__close" data-modal-close>&times;</button>
      </div>
      <div style="margin-bottom: 24px;">
        <p>Are you sure you want to delete this user? This action cannot be undone.</p>
      </div>
      <div style="display: flex; gap: 12px; justify-content: flex-end;">
        <button type="button" class="button" data-modal-close>Cancel</button>
        <button type="button" class="button button--danger" id="confirmDeleteBtn">Delete User</button>
      </div>
    </div>
  </div>

</main>

<script th:src="@{/js/users.js}"></script>

</body>
</html>